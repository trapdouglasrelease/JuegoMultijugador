<!DOCTYPE html>
<html>
<head>
    <title>Juego Multijugador</title>
    <style>
        canvas { border: 1px solid black; }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    
    <!-- Importar Socket.io (¡importante!) -->
    <script src="/socket.io/socket.io.js"></script>
    
    <script>
        // ----- CÓDIGO JAVASCRIPT -----
        const socket = io();  // Conexión al servidor
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const players = {};  // Almacena todos los jugadores

        // Dibuja todos los jugadores en el canvas
        function drawPlayers() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            Object.values(players).forEach(player => {
                ctx.fillStyle = player.color;
                ctx.beginPath();
                ctx.arc(player.x, player.y, 10, 0, Math.PI * 2);
                ctx.fill();
                // Mostrar ID del jugador (opcional)
                ctx.fillStyle = "black";
                ctx.font = "10px Arial";
                ctx.fillText(player.id.slice(0, 5), player.x - 10, player.y - 12);
            });
        }

        // Eventos de Socket.io
        socket.on("init", (data) => {
            players[socket.id] = data.currentPlayer;  // Tu jugador
            Object.assign(players, data.otherPlayers); // Jugadores existentes
            drawPlayers();
        });

        socket.on("newPlayer", (newPlayer) => {
            players[newPlayer.id] = newPlayer;
            drawPlayers();
        });

        socket.on("playerMoved", (data) => {
            if (players[data.id]) {
                players[data.id].x = data.x;
                players[data.id].y = data.y;
                drawPlayers();
            }
        });

        socket.on("playerDisconnected", (id) => {
            delete players[id];
            drawPlayers();
        });

        // Movimiento con teclado (solo para tu jugador)
        document.addEventListener("keydown", (e) => {
            const speed = 10;
            const player = players[socket.id];
            if (!player) return;

            if (e.key === "ArrowUp") player.y -= speed;
            if (e.key === "ArrowDown") player.y += speed;
            if (e.key === "ArrowLeft") player.x -= speed;
            if (e.key === "ArrowRight") player.x += speed;

            // Enviar movimiento al servidor
            socket.emit("playerMove", { x: player.x, y: player.y });
            drawPlayers();  // Actualizar localmente
        });
    </script>
</body>
</html>